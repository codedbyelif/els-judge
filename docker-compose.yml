version: '3.8'

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    ports:
      - "8000:8000"
    volumes:
      - ./:/app
      - data_volume:/app/data
    environment:
      # Use an absolute data path in docker so DB persists
      - DATABASE_URL=sqlite:////app/data/consensus.db
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      # You can change models via ENV vars
      - PRIMARY_MODEL=${PRIMARY_MODEL:-gpt-4o}
      - SECONDARY_MODEL=${SECONDARY_MODEL:-claude-3-5-sonnet-20240620}
      - TERTIARY_MODEL=${TERTIARY_MODEL:-gemini/gemini-flash-latest}

  dashboard:
    build:
      context: .
      dockerfile: Dockerfile.ui
    ports:
      - "8501:8501"
    volumes:
      - ./:/app
      - data_volume:/app/data
    environment:
      - DATABASE_URL=sqlite:////app/data/consensus.db
      - API_URL=http://api:8000
    depends_on:
      - api

volumes:
  data_volume:
